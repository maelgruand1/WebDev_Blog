<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Blog</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="navbar">
            <h1>My Blog</h1>
            <div id="userStatus">
                <span id="userName">Please log in to add articles.</span>
                <button id="loginButton">Login with Google</button>
                <button id="logoutButton" style="display:none;">Logout</button>
            </div>
        </div>
    </header>
    
    <main>
        <section id="articles" class="articles-container">
            <!-- Articles will be dynamically added here -->
        </section>

        <section class="add-article">
            <h2>Add a New Article</h2>
            <input type="text" id="title" placeholder="Article Title">
            <textarea id="content" rows="5" placeholder="Article Content"></textarea>
            <input type="text" id="tags" placeholder="Tags (comma-separated)">
            <button id="addArticle">Add Article</button>
        </section>
    </main>

    <script type="module">
        // Importer Firebase depuis le CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js";
    
        const firebaseConfig = {
            apiKey: "AIzaSyCz05n1FzvJTo54VA30UUV8VWBlwKZ7w5I",
            authDomain: "webblog-8922a.firebaseapp.com",
            projectId: "webblog-8922a",
            storageBucket: "webblog-8922a.firebasestorage.app",
            messagingSenderId: "576977340463",
            appId: "1:576977340463:web:d4b1e510d88d012f295eda",
            measurementId: "G-E3WTSKQRLW"
        };
    
        // Initialiser Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
    
        // V√©rifier l'√©tat de l'utilisateur (connect√© ou d√©connect√©)
        onAuthStateChanged(auth, user => {
            if (user) {
                document.getElementById('userName').textContent = user.displayName;
                document.getElementById('loginButton').style.display = 'none';
                document.getElementById('logoutButton').style.display = 'inline-block';
            } else {
                document.getElementById('userName').textContent = 'Please log in to add articles.';
                document.getElementById('loginButton').style.display = 'inline-block';
                document.getElementById('logoutButton').style.display = 'none';
            }
        });
    
        // Fonction de connexion Google
        document.getElementById('loginButton').addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (e) {
                console.error("Error signing in: ", e);
            }
        });
    
        // Fonction de d√©connexion
        document.getElementById('logoutButton').addEventListener('click', async () => {
            try {
                await signOut(auth);
            } catch (e) {
                console.error("Error signing out: ", e);
            }
        });
    
        // Ajouter un article
        document.getElementById('addArticle').addEventListener('click', async () => {
            const title = document.getElementById('title').value.trim();
            const content = document.getElementById('content').value.trim();
            const tags = document.getElementById('tags').value.split(',').map(tag => tag.trim());
            const date = new Date();
            const user = auth.currentUser;
    
            if (title && content && user) {
                try {
                    await addDoc(collection(db, "articles"), {
                        title,
                        content,
                        author: user.displayName,
                        date,
                        tags,
                        likes: 0,
                        comments: [],
                        userId: user.uid
                    });
    
                    const articleSection = document.getElementById('articles');
                    const article = document.createElement('div');
                    article.classList.add('article');
                    article.innerHTML = `
                        <h2>${title}</h2>
                        <p>${content}</p>
                        <p><strong>By:</strong> ${user.displayName}</p>
                        <div class="article-footer">
                            <button class="like-button">üëç Like</button>
                            <button class="comment-button">üí¨ Comment</button>
                        </div>
                    `;
                    articleSection.appendChild(article);
    
                    document.getElementById('title').value = '';
                    document.getElementById('content').value = '';
                    document.getElementById('tags').value = '';
                } catch (e) {
                    console.error("Error adding document: ", e);
                }
            } else {
                alert('Please fill out all required fields and make sure you are logged in!');
            }
        });
    
        // R√©cup√©rer les articles
        async function fetchArticles() {
            const querySnapshot = await getDocs(collection(db, "articles"));
            const articlesSection = document.getElementById('articles');
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const article = document.createElement('div');
                article.classList.add('article');
                article.innerHTML = `
                    <h2>${data.title}</h2>
                    <p>${data.content}</p>
                    <p><strong>By:</strong> ${data.author}</p>
                    <div class="article-footer">
                        <button class="like-button">üëç Like</button>
                        <button class="comment-button">üí¨ Comment</button>
                    </div>
                `;
                articlesSection.appendChild(article);
            });
        }
    
        fetchArticles();
    </script>
    
</body>
</html>
